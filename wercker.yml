box: node:9

build:
  steps:
    - npm-install

    - script:
      name: build
      code: |-
        npm run build

    - script:
      name: artifacts
      code: |-
        mv "$WERCKER_SOURCE_DIR/dist" "$WERCKER_OUTPUT_DIR/"
        mv "$WERCKER_SOURCE_DIR/assets" "$WERCKER_OUTPUT_DIR/"
        mv "$WERCKER_SOURCE_DIR/index.html" "$WERCKER_OUTPUT_DIR/"

deploy:
  steps:
    - install-packages:
      packages: rsync

    - add-to-known_hosts:
      local: true
      hostname: insider.thinxcloud-staging.de
      fingerprint: EM54sOaXYyGY3YJsHm/mceg+Qmuauv1t68p20NxPpag

    - add-ssh-key:
      keyname: SSH_KEY
      host: insider.thinxcloud-staging.de

    - script:
      name: sending files
      code: |-
        rsync -arz "$WERCKER_SOURCE_DIR/" insider@insider.thinxcloud-staging.de:/opt/tanktaler-insider-program-fe
